<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced MIMO Wireless Communication Equalizer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="./css/main.css">

</head>
<body>
    <div class="container-fluid">
        <div class="main-header">
            <h1>Advanced MIMO Wireless Communication Equalizer</h1>
            <p>Interactive Simulation with Complex Channels & Constellation Analysis</p>
        </div>

        <div class="experiment-container">
            <div class="tab-container">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="equalizer-tab" data-bs-toggle="tab" data-bs-target="#equalizer" type="button" role="tab">Equalizer Simulation</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="performance-tab" data-bs-toggle="tab" data-bs-target="#performance" type="button" role="tab">Performance Analysis</button>
                    </li>
                </ul>
            </div>

            <div class="tab-content">
                <div class="tab-pane fade show active" id="equalizer" role="tabpanel">
                    <div class="v-collapsible-instruction-container v-instruction-container">
                        <div class="v-collapsible is-size-5">Instructions</div>
                        <div class="v-content" style="text-align: left; padding-left: 10%; padding-right: 10%;">
                            <ol>
                                <li><strong>Getting Started:</strong> This simulation demonstrates MIMO equalization techniques (ZF and MMSE) for wireless systems.</li>
                                <li><strong>Configure Setup:</strong> Select your modulation scheme (BPSK, QPSK, QAM) and MIMO configuration (Nt transmit Ã— Nr receive antennas).</li>
                                <li><strong>Set Parameters:</strong> Adjust the SNR value to simulate different channel conditions.</li>
                                <li><strong>Simulate Channel:</strong> Click the "Simulate Channel" button to generate a random MIMO channel and observe equalization.</li>
                                <li><strong>Compare Equalizers:</strong> Switch between ZF and MMSE equalizer types to compare their performance.</li>
                                <li><strong>Analyze Results:</strong> Examine the signal flow diagrams, constellation plots, and performance metrics.</li>
                                <li><strong>Run New Simulation:</strong> Click "Run with New Symbols" to repeat with different random symbols while keeping the same channel.</li>
                            </ol>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xl-3 col-lg-4 col-md-12">
                            <div class="control-panel">
                                <h4>Inputs</h4>
                                <div class="input-group horizontal">
                                    <label for="modulationScheme">Modulation:</label>
                                    <select class="form-select" id="modulationScheme">
                                        <option value="BPSK">BPSK</option>
                                        <option value="QPSK" selected>QPSK</option>
                                        <option value="16QAM">16-QAM</option>
                                        <option value="64QAM">64-QAM</option>
                                    </select>
                                </div>
                                <div class="input-group horizontal">
                                    <label for="numTxAntennas">Tx Antennas (Nt):</label>
                                    <select class="form-select" id="numTxAntennas">
                                        <option value="2" selected>2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="6">6</option>
                                        <option value="8">8</option>
                                        <option value="16">16</option>
                                    </select>
                                </div>
                                <div class="input-group horizontal">
                                    <label for="numRxAntennas">Rx Antennas (Nr):</label>
                                    <select class="form-select" id="numRxAntennas">
                                        <option value="2" selected>2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="6">6</option>
                                        <option value="8">8</option>
                                        <option value="16">16</option>
                                    </select>
                                </div>
                                <div class="input-group horizontal">
                                    <label for="snrInput">SNR (dB):</label>
                                    <input type="number" class="form-control" id="snrInput" value="10" min="0" max="40" step="1">
                                </div>
                                
                                <button class="btn btn-primary w-100 mt-3" id="simulateBtn" onclick="runSimulation()">Simulate Channel</button>
                                <button class="btn btn-secondary w-100 mt-3" id="regenerateBtn" onclick="runSimulation()" style="display:none;">Run with New Symbols</button>

                                <div class="technique-selector" id="techniqueSelector" style="display: none;">
                                    <h5>Equalizer Type:</h5>
                                    <div class="technique-options">
                                        <div class="technique-option">
                                            <input type="radio" id="zf" name="technique" value="ZF" checked onchange="updateDisplay()">
                                            <label for="zf">ZF</label>
                                        </div>
                                        <div class="technique-option">
                                            <input type="radio" id="mmse" name="technique" value="MMSE" onchange="updateDisplay()">
                                            <label for="mmse">MMSE</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-6 col-lg-8 col-md-12">
                            <div class="visualization-area">
                                <div id="loadingIndicator" class="loading"><div class="spinner"></div><p>Processing...</p></div>
                                <div class="signal-flow" id="signalFlow">
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-lg-12 col-md-12">
                            <div class="output-panel" id="resultsContainer" style="display: none;">
                                <div class="results-panel">
                                    <h4>Performance</h4>
                                    <div class="metric-card"><div class="metric-label">Symbol Error Rate (SER)</div><div class="metric-value" id="serValue">-</div></div>
                                    <div class="metric-card"><div class="metric-label">Symbols in Error</div><div class="metric-value" id="errorCount">-</div></div>
                                    <div class="metric-card"><div class="metric-label">Channel Condition</div><div class="metric-value" id="conditionNumber">-</div></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-12" id="constellationSection" style="display: none;">
                            <div class="constellation-container">
                                <div class="constellation-plot"><h5>Original Transmitted</h5><canvas id="originalConstellation"></canvas></div>
                                <div class="constellation-plot"><h5>Channel Distorted + Noise</h5><canvas id="distortedConstellation"></canvas></div>
                                <div class="constellation-plot" id="equalizedPlot"><h5>Equalized (ZF)</h5><canvas id="equalizedConstellation"></canvas></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="performance" role="tabpanel">
                    <div class="v-collapsible-instruction-container v-instruction-container">
                        <div class="v-collapsible is-size-5">Instructions</div>
                        <div class="v-content" style="text-align: left; padding-left: 10%; padding-right: 10%;">
                            <ol>
                                <li><strong>Performance Analysis:</strong> This tab allows you to compare SER (Symbol Error Rate) for different configurations.</li>
                                <li><strong>Select Parameters:</strong> Choose modulation scheme, antenna configuration, and noise enhancement factor.</li>
                                <li><strong>Choose Equalizer:</strong> Select either ZF or MMSE equalization technique.</li>
                                <li><strong>Generate Curve:</strong> Click "Plot Configuration" to add a SER curve to the chart.</li>
                                <li><strong>Compare Results:</strong> Add up to 5 different configurations to compare their performance.</li>
                                <li><strong>Start Over:</strong> Click "Reset Plots" to clear all curves and begin a new comparison.</li>
                                <li><strong>Interpretation:</strong> Lower curves indicate better performance. MMSE typically outperforms ZF at low SNR values.</li>
                            </ol>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-xl-6 col-lg-5 col-md-12">
                            <div class="analysis-control-panel">
                                <h4>Plot Controls</h4>
                                <div class="input-group horizontal">
                                    <label for="analysisModulation">Modulation:</label>
                                    <select class="form-select" id="analysisModulation">
                                        <option value="BPSK">BPSK</option>
                                        <option value="QPSK" selected>QPSK</option>
                                        <option value="16QAM">16-QAM</option>
                                        <option value="64QAM">64-QAM</option>
                                    </select>
                                </div>
                                <div class="input-group horizontal">
                                    <label for="analysisNumTxAntennas">Tx Antennas (Nt):</label>
                                    <select class="form-select" id="analysisNumTxAntennas">
                                        <option value="2" selected>2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                    </select>
                                </div>
                                <div class="input-group horizontal">
                                    <label for="analysisNumRxAntennas">Rx Antennas (Nr):</label>
                                    <select class="form-select" id="analysisNumRxAntennas">
                                        <option value="2" selected>2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                    </select>
                                </div>
                                <div class="input-group horizontal" id="channelConditionGroup">
                                    <label for="channelConditionFactor">Noise Enhancement Factor:</label>
                                    <select class="form-select" id="channelConditionFactor">
                                        <option value="1.0" selected>1.0</option>
                                        <option value="1.5">1.5</option>
                                        <option value="2.0">2.0</option>
                                        <option value="3.0">3.0</option>
                                        <option value="5.0">5.0</option>
                                        <option value="10.0">10.0</option>
                                    </select>
                                </div>
                                <div class="technique-selector">
                                    <h5>Equalizer Type:</h5>
                                    <div class="technique-options">
                                        <div class="technique-option">
                                            <input type="radio" id="analysisZf" name="analysisTechnique" value="ZF" checked>
                                            <label for="analysisZf">ZF</label>
                                        </div>
                                        <div class="technique-option">
                                            <input type="radio" id="analysisMmse" name="analysisTechnique" value="MMSE">
                                            <label for="analysisMmse">MMSE</label>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-success w-100 mt-3" id="plotConfigBtn" onclick="addSERCurve()">Plot Configuration</button>
                                <button class="btn btn-secondary w-100 mt-3" id="resetPlotsBtn" onclick="resetSERChart()">Reset Plots</button>
                            </div>
                        </div>
                        <div class="col-xl-6 col-lg-7 col-md-12">
                            <div class="chart-container" id="serChartContainer">
                                <div id="chartLoadingIndicator" class="loading"><div class="spinner"></div><p>Generating SER curve...</p></div>
                                <h4>Symbol Error Rate vs. SNR</h4>
                                <canvas id="serChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="./js/main.js"></script>
    <script>
        // Add this to ensure Chart.js canvases resize properly
        window.addEventListener('resize', function() {
            const canvases = document.querySelectorAll('.constellation-plot canvas');
            canvases.forEach(canvas => {
                if (canvas.chart) {
                    canvas.chart.resize();
                }
            });
        });
        
        // Add collapsible functionality for the instructions
        document.addEventListener('DOMContentLoaded', function() {
            const collapsibles = document.querySelectorAll('.v-collapsible');
            collapsibles.forEach(item => {
                item.addEventListener('click', function() {
                    this.classList.toggle('active');
                });
            });
        });
    </script>
</body>
</html>